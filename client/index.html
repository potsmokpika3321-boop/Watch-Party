<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self' ws: wss:; media-src 'self' blob: data:;" />
    <link rel="icon" type="image/x-icon" href="/television.ico" />
    <title>WatchParty - Watch Together</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div class="app-container">
      <header class="app-header">
        <div class="logo-section">
          <div class="logo">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 5v14l11-7z" fill="currentColor"/>
            </svg>
          </div>
          <h1>WatchParty</h1>
        </div>
        <div class="nav-buttons" style="display:flex;align-items:center;gap:12px;">
          <button id="backHomeBtn" style="background:#1e293b;color:#cbd5e1;border:1px solid #334155;padding:8px 14px;border-radius:8px;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2Z" fill="currentColor"/></svg>
            Home
          </button>
        </div>
        <div class="connection-status">
          <div class="status-indicator" id="statusIndicator">
            <div class="pulse-dot"></div>
            <span id="status" class="status-text">Connecting...</span>
          </div>
        </div>
      </header>

      <main class="video-section">
        <div class="video-container">
          <video id="video" controls playsinline preload="metadata" crossorigin="anonymous">
            Your browser does not support the video tag.
          </video>
        </div>
        
        <div class="controls-section">
          <div class="control-card">
            <div class="status-info">
              <div class="role-indicator">
                <span class="role-text" id="roleText">Connecting...</span>
              </div>
              <div class="share-section" id="shareSection" style="display: none;">
                <span class="share-label">Share this link:</span>
                <div class="share-link-container">
                  <input type="text" id="shareUrl" readonly class="share-url-input">
                  <button class="copy-btn" id="copyLinkBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z" fill="currentColor"/>
                    </svg>
                    Copy
                  </button>
                </div>
                <div class="lan-fallback" id="lanFallback" style="display:none;margin-top:8px;font-size:12px;color:#9ca3af;">
                  No public URL yet. You can share a local network link instead:
                  <span id="lanUrls"></span>
                </div>
              </div>
              <div class="server-logs" id="serverLogs" style="display: none;">
                <div class="logs-header">
                  <span class="logs-label">Server Logs:</span>
                  <button class="toggle-logs-btn" id="toggleLogsBtn">Show</button>
                </div>
                <div class="logs-content" id="logsContent" style="display: none;">
                  <pre id="logsText"></pre>
                </div>
              </div>
            </div>
            <div class="action-buttons">
              <button class="action-btn primary" id="startVideoBtn" style="display: none;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M8 5v14l11-7z" fill="currentColor"/>
                </svg>
                Start Watching
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/script.js"></script>
    <script>
      // Back to home: use IPC to tell main process to load welcome page
      (function(){
        const btn = document.getElementById('backHomeBtn');
        if (!btn) return;
        btn.addEventListener('click', () => {
          if (window.watchparty) {
            window.watchparty.send('navigate-home');
          }
        });
      })();
    </script>
  </body>
</html>
